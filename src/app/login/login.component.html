<div class="flex align-items-center justify-content-center h-screen bg-primary-50 p-8">

  <p-toast></p-toast>

  <p-card class="w-full max-w-md shadow-4 border-round-lg mx-8">
    <ng-template pTemplate="header">
      <div class="text-center py-4">
        <h1 class="text-3xl font-bold text-900 m-0">{{ 'LOGIN.login_screen' | translate }}</h1>
        <p class="text-600 mt-2 mb-0">{{ 'HOME.WELCOME_BACK' | translate }}!</p>
      </div>
    </ng-template>
    <ng-template pTemplate="footer">
      <div class="text-center mt-2">
        <p-button
          type="button"
          [label]="'LOGIN.forgot_password' | translate"
          severity="secondary"
          [text]="true"
          (onClick)="onForgotPassword()"
          styleClass="p-0"/>
      </div>
    </ng-template>

    <form [formGroup]="loginForm" (ngSubmit)="onSubmit()" class="flex flex-column gap-4">

      <!-- System ID Field -->
      @if (showSystemId()) {
        <div class="field">
          <label for="systemId" class="block text-900 font-medium mb-2">{{ 'LOGIN.system_id' | translate }} *</label>
          <input pInputText
                 id="systemId"
                 type="number"
                 formControlName="systemId"
                 [placeholder]="'LOGIN.system_id' | translate"
                 class="w-full"
                 [class.ng-invalid]="isFieldInvalid('systemId')"
          />
          <div class="h-1rem mt-1">
            @if (isFieldInvalid('systemId')) {
              <small class="p-error">{{ 'LOGIN.system_id_err' | translate }}</small>
            }
          </div>
        </div>
      }

      <!-- Username Field -->
      <div class="field">
        <label for="username" class="block text-900 font-medium mb-2">{{ 'LOGIN.user_name' | translate }} *</label>
        <input pInputText
               id="username"
               formControlName="username"
               [placeholder]="'LOGIN.user_name' | translate"
               class="w-full"
               [class.ng-invalid]="isFieldInvalid('username')"
        />
        <div class="h-1rem mt-1">
          @if (isFieldInvalid('username')) {
            <small class="p-error">{{ 'LOGIN.username_err' | translate }}</small>
          }
        </div>
      </div>

      <!-- Password Field -->
      <div class="field">
        <label for="password" class="block text-900 font-medium mb-2">{{ 'LOGIN.pass' | translate }} *</label>
        <p-password formControlName="password"
                    [placeholder]="'LOGIN.pass' | translate"
                    [toggleMask]="true"
                    [feedback]="false"
                    styleClass="w-full"
                    inputStyleClass="w-full"
        />
        <div class="h-1rem mt-1">
          @if (isFieldInvalid('password')) {
            <small class="p-error">{{ 'LOGIN.pass_err' | translate }}</small>
          }
        </div>
      </div>

      <!-- Accept Terms (Required) -->
      <div class="field">
        <div class="flex align-items-center gap-2">
          <p-checkbox inputId="acceptTerms"
                      formControlName="acceptTerms"
                      [binary]="true"></p-checkbox>
          <label for="acceptTerms" class="text-900">
            I accept the <a href="assets/terms.html" target="_blank" rel="noopener noreferrer">terms</a> *
          </label>
        </div>
        <div class="h-1rem mt-1">
          @if (isFieldInvalid('acceptTerms')) {
            <small class="p-error">You must accept the terms</small>
          }
        </div>
      </div>

       <!-- Auto Login Checkbox -->
      <div class="field">
        <div class="flex align-items-center gap-2">
          <p-checkbox inputId="autoLogin"
                      formControlName="autoLogin"
                      [binary]="true"/>
          <label for="autoLogin" class="text-900">{{ 'LOGIN.login_automatically' | translate }}</label>
        </div>
      </div>

      <!-- Submit Button -->
      <p-button type="submit"
                [label]="'LOGIN.enter' | translate"
                icon="pi pi-sign-in"
                [loading]="loading()"
                [disabled]="loading() || loginForm.invalid"
                styleClass="w-full"
                size="large"/>
    </form>
  </p-card>

  <!-- Forgot Password Dialog -->
  <p-dialog 
    [header]="'LOGIN.forgot_password' | translate"
    [visible]="showForgotPasswordDialog()"
    (visibleChange)="showForgotPasswordDialog.set($event)"
    [modal]="true"
    [style]="{width: '450px'}"
    [draggable]="false"
    [resizable]="false">
    
    <form [formGroup]="forgotPasswordForm" (ngSubmit)="onSubmitForgotPassword()" class="flex flex-column gap-4">
      <!-- System ID Field -->
      <div class="field">
        <label for="forgotSystemId" class="block text-900 font-medium mb-2">{{ 'LOGIN.system_id' | translate }} *</label>
        <input pInputText
               id="forgotSystemId"
               type="number"
               formControlName="systemId"
               [placeholder]="'LOGIN.system_id' | translate"
               class="w-full"
        />
      </div>

      <!-- Send Reset To Selection -->
      <div class="field">
        <label class="block text-900 font-medium mb-3">Send password reset to: *</label>
        <div class="flex gap-4">
          <div class="flex align-items-center">
            <p-radioButton name="resetMethod" 
                          value="email" 
                          formControlName="resetMethod"
                          inputId="resetEmail" />
            <label for="resetEmail" class="ml-2 text-900">Email</label>
          </div>
          <div class="flex align-items-center">
            <p-radioButton name="resetMethod" 
                          value="mobile" 
                          formControlName="resetMethod"
                          inputId="resetMobile" />
            <label for="resetMobile" class="ml-2 text-900">Mobile</label>
          </div>
        </div>
      </div>

      <!-- Email Field -->
      @if (forgotPasswordForm.get('resetMethod')?.value === 'email') {
        <div class="field">
          <label for="forgotEmail" class="block text-900 font-medium mb-2">Email Address *</label>
          <input pInputText
                 id="forgotEmail"
                 type="email"
                 formControlName="email"
                 placeholder="Enter your email address"
                 class="w-full"
          />
        </div>
      }

      <!-- Mobile Field -->
      @if (forgotPasswordForm.get('resetMethod')?.value === 'mobile') {
        <div class="field">
          <label for="forgotMobile" class="block text-900 font-medium mb-2">Mobile Number *</label>
          <input pInputText
                 id="forgotMobile"
                 type="tel"
                 formControlName="mobile"
                 placeholder="Enter your mobile number"
                 class="w-full"
          />
        </div>
      }

      <div class="flex justify-content-end gap-2">
        <p-button 
          type="button"
          label="Cancel" 
          severity="secondary"
          (onClick)="onCancelForgotPassword()" />
        <p-button 
          type="submit"
          label="Submit"
          [disabled]="forgotPasswordForm.invalid"
          [loading]="forgotPasswordLoading()" />
      </div>
    </form>
  </p-dialog>
</div>
